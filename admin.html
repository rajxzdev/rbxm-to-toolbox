<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel - Roblox Uploader</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --bg:#0a0612;--p1:#1a0a2e;--p3:#7c3aed;--pg:#a78bfa;--ps:#c4b5fd;--pk:#ec4899;
      --tx:#f1e8ff;--tx2:rgba(241,232,255,.55);
      --ok:#34d399;--er:#f87171;--wn:#fbbf24;
      --gl:rgba(139,92,246,.08);--gb:rgba(139,92,246,.2);
      --r:20px;--rs:12px
    }
    body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;overflow-x:hidden}
    body::before{content:'';position:fixed;inset:0;background:
      radial-gradient(ellipse 80% 60% at 20% 30%,rgba(124,58,237,.15),transparent),
      radial-gradient(ellipse 60% 80% at 80% 70%,rgba(236,72,153,.10),transparent);
      z-index:0;pointer-events:none}
    .container{max-width:820px;margin:0 auto;padding:16px;position:relative;z-index:1}

    .glass{
      background:linear-gradient(135deg,rgba(139,92,246,.10),rgba(139,92,246,.04),rgba(236,72,153,.04));
      backdrop-filter:blur(40px) saturate(1.5);
      -webkit-backdrop-filter:blur(40px) saturate(1.5);
      border:1px solid var(--gb);
      border-radius:var(--r);
      position:relative;overflow:hidden
    }
    .glass::before{
      content:'';position:absolute;top:0;left:0;right:0;height:1px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.14),transparent);
      pointer-events:none
    }

    .header{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;margin-bottom:12px}
    .logo{display:flex;align-items:center;gap:12px}
    .logo-icon{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,var(--p3),var(--pk));display:flex;align-items:center;justify-content:center;font-size:20px}
    .logo h1{font-size:16px;font-weight:900;background:linear-gradient(135deg,var(--ps),var(--pk));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .logo small{display:block;font-size:11px;color:var(--tx2);margin-top:2px}

    .icon-btn{
      width:38px;height:38px;border-radius:50%;
      border:1px solid var(--gb);background:var(--gl);color:var(--pg);
      display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.25s
    }
    .icon-btn:hover{border-color:var(--p3);background:rgba(124,58,237,.15);transform:translateY(-1px)}

    .card{padding:18px;margin-bottom:12px}
    .tabs{display:flex;gap:6px;padding:6px;background:rgba(139,92,246,.06);border-radius:14px;margin-bottom:12px;flex-wrap:wrap}
    .tab{
      flex:1;min-width:120px;text-align:center;padding:10px;border-radius:10px;
      font-size:13px;font-weight:800;color:var(--tx2);cursor:pointer;
      border:1px solid transparent;transition:.25s;user-select:none
    }
    .tab.active{background:rgba(124,58,237,.20);border-color:rgba(124,58,237,.30);color:var(--tx)}

    label{display:block;margin-top:12px;margin-bottom:6px;color:var(--tx2);font-size:13px;font-weight:700}
    input,textarea,select{
      width:100%;padding:12px 14px;border-radius:var(--rs);
      background:rgba(139,92,246,.06);border:1px solid rgba(139,92,246,.15);
      color:var(--tx);font-family:inherit;font-size:14px;outline:none;transition:.25s
    }
    input:focus,textarea:focus,select:focus{border-color:var(--p3);box-shadow:0 0 0 3px rgba(124,58,237,.10)}
    textarea{min-height:90px;resize:vertical}
    select option{background:var(--p1);color:var(--tx)}

    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > div{flex:1;min-width:180px}

    .btn{
      width:100%;padding:14px;margin-top:12px;border-radius:var(--rs);
      border:1px solid rgba(124,58,237,.35);
      background:linear-gradient(135deg,rgba(124,58,237,.26),rgba(236,72,153,.14));
      color:var(--tx);font-weight:900;font-size:14px;
      cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:.25s
    }
    .btn:hover{border-color:var(--p3);box-shadow:0 0 22px rgba(124,58,237,.18)}
    .btn:disabled{opacity:.55;cursor:not-allowed;box-shadow:none}
    .btn.sm{width:auto;padding:10px 12px;font-size:13px;margin:0}
    .btn.ok{background:rgba(52,211,153,.14);border-color:rgba(52,211,153,.26);color:var(--ok)}
    .btn.er{background:rgba(248,113,113,.14);border-color:rgba(248,113,113,.26);color:var(--er)}

    .msg{display:none;margin-top:10px;padding:10px 12px;border-radius:12px;font-size:13px;word-break:break-word}
    .msg.ok{display:block;background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.22);color:var(--ok)}
    .msg.er{display:block;background:rgba(248,113,113,.08);border:1px solid rgba(248,113,113,.22);color:var(--er)}
    .msg.info{display:block;background:rgba(139,92,246,.08);border:1px solid rgba(139,92,246,.22);color:var(--pg)}

    .muted{font-size:12px;color:var(--tx2);line-height:1.55}

    .qris-preview{
      margin-top:10px;max-width:260px;width:100%;display:none;
      border-radius:14px;border:1px solid rgba(139,92,246,.22)
    }
    .qris-preview.show{display:block}

    .table{width:100%;border-collapse:collapse;font-size:12px;margin-top:10px}
    .table th{color:var(--tx2);text-align:left;padding:10px 8px;border-bottom:1px solid rgba(139,92,246,.18)}
    .table td{padding:10px 8px;border-bottom:1px solid rgba(139,92,246,.08)}
    .badge{display:inline-block;padding:2px 8px;border-radius:8px;font-size:11px;font-weight:900}
    .b-pending{background:rgba(251,191,36,.12);border:1px solid rgba(251,191,36,.25);color:var(--wn)}
    .b-approved{background:rgba(52,211,153,.12);border:1px solid rgba(52,211,153,.25);color:var(--ok)}
    .b-rejected{background:rgba(248,113,113,.12);border:1px solid rgba(248,113,113,.25);color:var(--er)}

    .tx{padding:12px;border-radius:14px;background:rgba(139,92,246,.05);border:1px solid rgba(139,92,246,.14);margin-top:10px}
    .tx .top{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .tx .top b{font-size:13px}
    .tx .meta{margin-top:6px;color:var(--tx2);font-size:12px;line-height:1.4}
    .tx .actions{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}

    .hidden{display:none}

    @media(max-width:560px){
      .tab{min-width:110px}
    }
  </style>
</head>
<body>

<div class="container">

  <div class="glass header">
    <div class="logo">
      <div class="logo-icon"><i class="fas fa-shield-alt"></i></div>
      <div>
        <h1>Admin Panel</h1>
        <small>Payment · Coins · Users · Topup</small>
      </div>
    </div>

    <div style="display:flex;gap:8px;align-items:center">
      <button class="icon-btn" onclick="reloadAll()" title="Reload"><i class="fas fa-rotate"></i></button>
      <button class="icon-btn" onclick="adminLogout()" title="Logout"><i class="fas fa-sign-out-alt"></i></button>
    </div>
  </div>

  <!-- LOGIN -->
  <div id="loginCard" class="glass card" style="max-width:460px;margin:40px auto">
    <h2 style="font-size:16px;font-weight:900;display:flex;gap:8px;align-items:center">
      <i class="fas fa-lock" style="color:var(--pg)"></i> Admin Login
    </h2>
    <div class="muted">Masukkan password admin (contoh: <b>rajxz26</b>)</div>

    <label>Password</label>
    <input id="adminPw" type="password" placeholder="admin password">

    <button class="btn" id="loginBtn" onclick="adminLogin()"><i class="fas fa-right-to-bracket"></i><span>Login</span></button>
    <div class="msg" id="loginMsg"></div>

    <div class="muted" style="margin-top:12px">
      API: <code id="apiText"></code>
    </div>
  </div>

  <!-- PANEL -->
  <div id="panel" class="hidden">

    <div class="tabs">
      <div class="tab active" id="tabPay" onclick="showTab('pay')">Payment</div>
      <div class="tab" id="tabCoin" onclick="showTab('coin')">Coins</div>
      <div class="tab" id="tabUsers" onclick="showTab('users')">Users</div>
      <div class="tab" id="tabPending" onclick="showTab('pending')">Pending</div>
      <div class="tab" id="tabRecent" onclick="showTab('recent')">Recent</div>
    </div>

    <!-- PAYMENT -->
    <div id="pay" class="glass card">
      <h2><i class="fas fa-credit-card" style="color:var(--pg)"></i> Payment Methods</h2>
      <div class="muted">QRIS harus <b>upload gambar</b> (base64), bukan URL.</div>

      <label>QRIS Image (upload)</label>
      <input type="file" id="qrisFile" accept="image/*">
      <img id="qrisPreview" class="qris-preview" alt="QRIS Preview">
      <input type="hidden" id="qrisBase64" value="">

      <div class="row">
        <div><label>Dana</label><input id="pmDana" placeholder="08xxxx"></div>
        <div><label>GoPay</label><input id="pmGopay" placeholder="08xxxx"></div>
      </div>
      <div class="row">
        <div><label>OVO</label><input id="pmOvo" placeholder="08xxxx"></div>
        <div><label>ShopeePay</label><input id="pmShopee" placeholder="08xxxx"></div>
      </div>
      <div class="row">
        <div><label>No Rekening</label><input id="pmNorek" placeholder="(boleh kosong)"></div>
        <div><label>Nama Bank</label><input id="pmBank" placeholder="BCA/BRI/dll"></div>
      </div>

      <button class="btn" id="savePayBtn" onclick="savePayment()"><i class="fas fa-save"></i><span>Save Payment</span></button>
      <div class="msg" id="payMsg"></div>
    </div>

    <!-- COINS -->
    <div id="coin" class="glass card hidden">
      <h2><i class="fas fa-coins" style="color:var(--wn)"></i> Coin Settings</h2>
      <div class="muted">upload_cost = biaya upload asset, script_cost = biaya create share link script (.lua)</div>

      <div class="row">
        <div>
          <label>Price per Coin (Rp)</label>
          <input id="csPrice" type="number" placeholder="1000">
        </div>
        <div>
          <label>Min Topup (coins)</label>
          <input id="csMin" type="number" placeholder="5">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Upload Cost (coins)</label>
          <input id="csUploadCost" type="number" placeholder="1">
        </div>
        <div>
          <label>Script Cost (coins)</label>
          <input id="csScriptCost" type="number" placeholder="1">
        </div>
      </div>

      <button class="btn" id="saveCoinBtn" onclick="saveCoinSettings()"><i class="fas fa-save"></i><span>Save Coin Settings</span></button>
      <div class="msg" id="coinMsg"></div>
    </div>

    <!-- USERS -->
    <div id="users" class="glass card hidden">
      <h2><i class="fas fa-users" style="color:var(--pg)"></i> Users</h2>
      <div class="muted">List user + saldo coin. Manual topup dari sini.</div>

      <button class="btn" onclick="loadUsers()"><i class="fas fa-rotate"></i><span>Refresh Users</span></button>
      <div id="usersBox" class="muted" style="margin-top:10px">Loading...</div>

      <hr style="border-color:rgba(139,92,246,.12);margin:14px 0">

      <h2 style="font-size:14px"><i class="fas fa-plus" style="color:var(--ok)"></i> Manual Topup</h2>
      <div class="row">
        <div><label>Username</label><input id="mtUser" placeholder="username"></div>
        <div><label>Amount</label><input id="mtAmount" type="number" placeholder="10"></div>
      </div>
      <button class="btn ok" id="mtBtn" onclick="manualTopup()"><i class="fas fa-coins"></i><span>Add Coins</span></button>
      <div class="msg" id="mtMsg"></div>
    </div>

    <!-- PENDING -->
    <div id="pending" class="glass card hidden">
      <h2><i class="fas fa-hourglass-half" style="color:var(--wn)"></i> Pending Topup</h2>
      <div class="muted">Approve / Reject request user.</div>

      <button class="btn" onclick="loadTransactions()"><i class="fas fa-rotate"></i><span>Refresh Pending</span></button>
      <div id="pendingBox" class="muted" style="margin-top:10px">Loading...</div>
    </div>

    <!-- RECENT -->
    <div id="recent" class="glass card hidden">
      <h2><i class="fas fa-chart-line" style="color:var(--pg)"></i> Recent Transactions</h2>
      <div class="muted">20 transaksi terakhir (approved/rejected/pending).</div>

      <button class="btn" onclick="loadTransactions()"><i class="fas fa-rotate"></i><span>Refresh Recent</span></button>
      <div id="recentBox" class="muted" style="margin-top:10px">Loading...</div>
    </div>

  </div>
</div>

<script>
  const API = "https://rbxm-api.mobilador0910.workers.dev";
  document.getElementById("apiText").textContent = API;

  let adminToken = localStorage.getItem("admin_token") || "";

  function setMsg(id,type,text){
    const el=document.getElementById(id);
    el.className="msg "+type;
    el.textContent=text;
  }
  function setLoading(btnId,on){
    const b=document.getElementById(btnId);
    if(!b) return;
    if(on){b.disabled=true;b.dataset.old=b.innerHTML;b.innerHTML='<i class="fas fa-spinner fa-spin"></i> Loading...';}
    else{b.disabled=false;if(b.dataset.old)b.innerHTML=b.dataset.old;}
  }

  function aj(path, method, body){
    const headers={"Content-Type":"application/json","Authorization":"Bearer "+adminToken};
    const opt={method:method||"GET",headers};
    if(body) opt.body=JSON.stringify(body);
    return fetch(API+path,opt).then(r=>r.json());
  }

  async function adminLogin(){
    const pw=document.getElementById("adminPw").value;
    if(!pw) return setMsg("loginMsg","er","Isi password");
    setLoading("loginBtn",true);
    setMsg("loginMsg","info","Logging in...");

    try{
      const r = await fetch(API+"/api/admin/login",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({password:pw})
      });
      const d = await r.json();

      if(!d.success){
        setMsg("loginMsg","er",d.error||"Wrong password");
        return;
      }
      adminToken = d.token;
      localStorage.setItem("admin_token", adminToken);

      document.getElementById("loginCard").classList.add("hidden");
      document.getElementById("panel").classList.remove("hidden");

      await reloadAll();

    }catch(e){
      setMsg("loginMsg","er","Network error");
    }finally{
      setLoading("loginBtn",false);
    }
  }

  function adminLogout(){
    adminToken="";
    localStorage.removeItem("admin_token");
    location.reload();
  }

  function showTab(name){
    const tabs=["pay","coin","users","pending","recent"];
    tabs.forEach(t=>{
      document.getElementById(t).classList.toggle("hidden", t!==name);
    });
    document.getElementById("tabPay").classList.toggle("active",name==="pay");
    document.getElementById("tabCoin").classList.toggle("active",name==="coin");
    document.getElementById("tabUsers").classList.toggle("active",name==="users");
    document.getElementById("tabPending").classList.toggle("active",name==="pending");
    document.getElementById("tabRecent").classList.toggle("active",name==="recent");

    if(name==="users") loadUsers();
    if(name==="pending" || name==="recent") loadTransactions();
    if(name==="pay") loadPayment();
    if(name==="coin") loadCoinSettings();
  }

  // QRIS upload => base64
  document.getElementById("qrisFile").addEventListener("change", function(e){
    const f = e.target.files && e.target.files[0];
    if(!f) return;
    const r = new FileReader();
    r.onload = function(){
      const b64 = String(r.result||"");
      document.getElementById("qrisBase64").value = b64;
      const img = document.getElementById("qrisPreview");
      img.src = b64;
      img.classList.add("show");
    };
    r.readAsDataURL(f);
  });

  async function loadPayment(){
    try{
      const d = await aj("/api/admin/payment/get","GET");
      document.getElementById("pmDana").value = d.dana||"";
      document.getElementById("pmGopay").value = d.gopay||"";
      document.getElementById("pmOvo").value = d.ovo||"";
      document.getElementById("pmShopee").value = d.shopeepay||"";
      document.getElementById("pmNorek").value = d.norek||"";
      document.getElementById("pmBank").value = d.bank_name||"";

      if(d.qris_image){
        document.getElementById("qrisBase64").value = d.qris_image;
        const img = document.getElementById("qrisPreview");
        img.src = d.qris_image;
        img.classList.add("show");
      }
      setMsg("payMsg","info","Loaded.");
      setTimeout(()=>document.getElementById("payMsg").className="msg",800);
    }catch(e){
      setMsg("payMsg","er","Failed load payment");
    }
  }

  async function savePayment(){
    setLoading("savePayBtn",true);
    setMsg("payMsg","info","Saving...");
    try{
      const data = {
        qris_image: document.getElementById("qrisBase64").value || "",
        dana: document.getElementById("pmDana").value.trim(),
        gopay: document.getElementById("pmGopay").value.trim(),
        ovo: document.getElementById("pmOvo").value.trim(),
        shopeepay: document.getElementById("pmShopee").value.trim(),
        norek: document.getElementById("pmNorek").value.trim(),
        bank_name: document.getElementById("pmBank").value.trim(),
        custom: []
      };
      const d = await aj("/api/admin/payment","POST",data);
      if(d.success) setMsg("payMsg","ok","Saved ✅");
      else setMsg("payMsg","er",d.error||"Failed");
    }catch(e){
      setMsg("payMsg","er","Network error");
    }finally{
      setLoading("savePayBtn",false);
    }
  }

  async function loadCoinSettings(){
    try{
      const d = await aj("/api/admin/coin-settings/get","GET");
      document.getElementById("csPrice").value = d.price_per_coin||1000;
      document.getElementById("csMin").value = d.min_topup||5;
      document.getElementById("csUploadCost").value = d.upload_cost||1;
      document.getElementById("csScriptCost").value = d.script_cost || (d.upload_cost||1);
      setMsg("coinMsg","info","Loaded.");
      setTimeout(()=>document.getElementById("coinMsg").className="msg",800);
    }catch(e){
      setMsg("coinMsg","er","Failed load coin settings");
    }
  }

  async function saveCoinSettings(){
    setLoading("saveCoinBtn",true);
    setMsg("coinMsg","info","Saving...");
    try{
      const data = {
        price_per_coin: Number(document.getElementById("csPrice").value||1000),
        min_topup: Number(document.getElementById("csMin").value||5),
        upload_cost: Number(document.getElementById("csUploadCost").value||1),
        script_cost: Number(document.getElementById("csScriptCost").value||1)
      };
      const d = await aj("/api/admin/coin-settings","POST",data);
      if(d.success) setMsg("coinMsg","ok","Saved ✅");
      else setMsg("coinMsg","er",d.error||"Failed");
    }catch(e){
      setMsg("coinMsg","er","Network error");
    }finally{
      setLoading("saveCoinBtn",false);
    }
  }

  async function loadUsers(){
    const box=document.getElementById("usersBox");
    box.innerHTML = `<div class="muted">Loading...</div>`;
    try{
      const d = await aj("/api/admin/users","GET");
      const users = d.users||[];
      if(users.length===0){box.innerHTML=`<div class="muted">No users.</div>`;return;}
      let html = `<table class="table"><thead><tr><th>Username</th><th>Coins</th><th>Joined</th></tr></thead><tbody>`;
      users.forEach(u=>{
        html += `<tr>
          <td>${escapeHtml(u.username)}</td>
          <td style="color:var(--wn);font-weight:900">${Number(u.coin||0)}</td>
          <td style="color:var(--tx2)">${u.createdAt?new Date(u.createdAt).toLocaleDateString():"-"}</td>
        </tr>`;
      });
      html += `</tbody></table>`;
      box.innerHTML = html;
    }catch(e){
      box.innerHTML = `<div class="muted">Failed load users.</div>`;
    }
  }

  async function manualTopup(){
    const u=document.getElementById("mtUser").value.trim().toLowerCase();
    const a=Number(document.getElementById("mtAmount").value||0);
    if(!u || !a) return setMsg("mtMsg","er","Isi username & amount");
    setLoading("mtBtn",true);
    setMsg("mtMsg","info","Processing...");
    try{
      const d = await aj("/api/admin/topup","POST",{username:u,amount:a});
      if(d.success){
        setMsg("mtMsg","ok","Added ✅ New balance: "+d.newBalance);
        loadUsers();
      }else setMsg("mtMsg","er",d.error||"Failed");
    }catch(e){
      setMsg("mtMsg","er","Network error");
    }finally{
      setLoading("mtBtn",false);
    }
  }

  async function loadTransactions(){
    const pbox=document.getElementById("pendingBox");
    const rbox=document.getElementById("recentBox");
    pbox.innerHTML=`<div class="muted">Loading...</div>`;
    rbox.innerHTML=`<div class="muted">Loading...</div>`;

    try{
      const d = await aj("/api/admin/transactions","GET");

      // pending
      const pending = d.pending || [];
      if(pending.length===0){
        pbox.innerHTML = `<div class="muted">No pending ✅</div>`;
      }else{
        pbox.innerHTML = pending.map(t=>txCard(t,true)).join("");
      }

      // recent
      const recent = d.recent || [];
      if(recent.length===0){
        rbox.innerHTML = `<div class="muted">No recent.</div>`;
      }else{
        rbox.innerHTML = recent.map(t=>txCard(t,false)).join("");
      }

    }catch(e){
      pbox.innerHTML=`<div class="muted">Failed load pending.</div>`;
      rbox.innerHTML=`<div class="muted">Failed load recent.</div>`;
    }
  }

  function txCard(t, pendingActions){
    const st = String(t.status||"pending").toLowerCase();
    const badge = st==="approved" ? "b-approved" : st==="rejected" ? "b-rejected" : "b-pending";
    const time = t.time ? new Date(t.time).toLocaleString() : "-";
    const proof = t.proof ? escapeHtml(t.proof) : "";
    const method = t.method ? escapeHtml(t.method) : "-";
    const amt = Number(t.amount||0);

    let actions = "";
    if(pendingActions){
      actions = `
        <div class="actions">
          <button class="btn sm ok" onclick="approveTx('${t.id}')"><i class="fas fa-check"></i> Approve</button>
          <button class="btn sm er" onclick="rejectTx('${t.id}')"><i class="fas fa-times"></i> Reject</button>
        </div>
      `;
    }

    return `
      <div class="tx">
        <div class="top">
          <b>${escapeHtml(t.username||"-")}</b>
          <span class="badge ${badge}">${st}</span>
        </div>
        <div class="meta">+${amt} coins · ${method} · ${time}</div>
        ${proof ? `<div class="meta">Proof: ${proof}</div>` : ``}
        ${actions}
      </div>
    `;
  }

  async function approveTx(id){
    if(!confirm("Approve transaksi ini?")) return;
    try{
      const d = await aj("/api/admin/approve","POST",{txId:id});
      if(d.success){
        alert("Approved ✅ New balance: "+d.newBalance);
        loadTransactions();
        loadUsers();
      }else alert(d.error||"Failed");
    }catch(e){
      alert("Network error");
    }
  }

  async function rejectTx(id){
    const reason = prompt("Reason (opsional):") || "Rejected";
    if(!confirm("Reject transaksi ini?")) return;
    try{
      const d = await aj("/api/admin/reject","POST",{txId:id,reason});
      if(d.success){
        alert("Rejected ✅");
        loadTransactions();
      }else alert(d.error||"Failed");
    }catch(e){
      alert("Network error");
    }
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  async function reloadAll(){
    if(!adminToken) return;
    await loadPayment();
    await loadCoinSettings();
    await loadUsers();
    await loadTransactions();
  }

  // Auto show panel if token exists
  (async function boot(){
    if(!adminToken) return;
    document.getElementById("loginCard").classList.add("hidden");
    document.getElementById("panel").classList.remove("hidden");
    await reloadAll();
  })();
</script>

</body>
</html>
